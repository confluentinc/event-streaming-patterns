<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Event Serializer - Event Streaming Patterns</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Event Serializer";
    var mkdocs_page_input_path = "event/event-serializer.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Event Streaming Patterns</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Event Streaming Patterns</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Compositional patterns</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../compositional-patterns/command-query-responsibility-segregation.html">Command Query Responsibility Segregation (CQRS)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../compositional-patterns/event-collaboration.html">Event Collaboration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../compositional-patterns/geo-replication.html">Geo Replication</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../compositional-patterns/pipeline.html">Pipeline</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Event</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="command-event.html">Command Event</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="correlation-identifier.html">Correlation Identifier</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="data-contract.html">Data Contract</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="event-deserializer.html">Event Deserializer</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="event-envelope.html">Event Envelope</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="event-serializer.html">Event Serializer</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#problem">Problem</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#solution">Solution</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#considerations">Considerations</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#references">References</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#footnotes">Footnotes</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="event-standardizer.html">Event Standardizer</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="event.html">Event</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="schema-on-read.html">Schema-on-Read</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Event processing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/claim-check.html">Claim Check</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/content-filter.html">Content Filter</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/dead-letter-stream.html">Dead Letter Stream</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-chunking.html">Event Chunking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-filter.html">Event Filter</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-mapper.html">Event Mapper</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-processing-application.html">Event Processing Application</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-processor.html">Event Processor</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-router.html">Event Router</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-splitter.html">Event Splitter</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-streaming-api.html">Event Streaming API</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-processing/event-translator.html">Event Translator</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Event sink</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../event-sink/event-sink-connector.html">Event Sink Connector</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-sink/event-sink.html">Event Sink</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Event source</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../event-source/database-write-aside.html">Database Write Aside</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-source/database-write-through.html">Database Write Through</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-source/event-gateway.html">Event Gateway</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-source/event-source-connector.html">Event Source Connector</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-source/event-source.html">Event Source</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-source/schema-validator.html">Schema Validator</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Event storage</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../event-storage/compacted-event-stream.html">Compacted Event Stream</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-storage/event-store.html">Event Store</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-storage/infinite-retention-event-stream.html">Infinite Retention Event Stream</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-storage/limited-retention-event-stream.html">Limited Retention Event Stream</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Event stream</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../event-stream/event-broker.html">Event Broker</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-stream/event-stream.html">Event Stream</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-stream/event-streaming-platform.html">Event Streaming Platform</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-stream/partitioned-parallelism.html">Partitioned Parallelism</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-stream/schema-compatibility.html">Schema Compatibility</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../event-stream/schema-evolution.html">Schema Evolution</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Stream processing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/event-grouper.html">Event Grouper</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/event-joiner.html">Event Joiner</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/event-stream-merger.html">Event Stream Merger</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/event-time-processing.html">Event-Time Processing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/logical-and.html">Logical AND</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/suppressed-event-aggregator.html">Suppressed Event Aggregator</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/wait-for-n-events.html">Wait for N Events</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../stream-processing/wallclock-time.html">Wallclock-Time Processing</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Table</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../table/projection-table.html">Projection Table</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../table/state-table.html">State Table</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Event Streaming Patterns</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Event &raquo;</li>
        
      
    
    <li>Event Serializer</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="event-serializer">Event Serializer</h1>
<p>Data has a long lifecycle, often outliving the programs that
originally gathered and stored it. And data demands a broad
audience - the more accessible our data is, the more departments in
our organization can find use for it. </p>
<p>In a successful system, data gathered by the sales department in one
year may prove invaluable to the marketing department a few years
later, <em>provided they can actually access it</em>.</p>
<p>For maximum utility and longevity, data should be written in a way
that doesn't obscure it from future readers and writers. The data is
more important than today's technology choices.</p>
<p>How does this affect an event-based system? Are there any special
concerns for this kind of architecture, or will the programming
language's serialization tools suffice?</p>
<h2 id="problem">Problem</h2>
<p>How can I convert an event into a format understood by the event
streaming platform and applications that use it?</p>
<h2 id="solution">Solution</h2>
<p><img alt="event serializer" src="../img/event-serializer.svg" /></p>
<p>Use a language-agnostic serialization format. The ideal format would
be self-documenting, space-efficient, and designed to support some
degree of backwards and forwards -compatibility. We recommend
<a href="https://avro.apache.org/docs/current/">Avro</a>. (See "Considerations".)</p>
<p>An optional, recommended step is to register the serialization details
with a schema registry. A registry provides a reliable,
machine-readable reference point for <a href="event-deserializer.html">Event
Deserializers</a> and <a href="../event-source/schema-validator.html">Schema
Validators</a>, making event
consumption vastly simpler.</p>
<h2 id="implementation">Implementation</h2>
<p>For example, we can use Avro to define a structure for Foreign Exchange
trade deals as:</p>
<pre><code class="language-json">{&quot;namespace&quot;: &quot;io.confluent.developer&quot;,
 &quot;type&quot;: &quot;record&quot;,
 &quot;name&quot;: &quot;FxTrade&quot;,
 &quot;fields&quot;: [
     {&quot;name&quot;: &quot;trade_id&quot;, &quot;type&quot;: &quot;long&quot;},
     {&quot;name&quot;: &quot;from_currency&quot;, &quot;type&quot;: &quot;string&quot;},
     {&quot;name&quot;: &quot;to_currency&quot;, &quot;type&quot;: &quot;string&quot;},
     {&quot;name&quot;: &quot;price&quot;, &quot;type&quot;: &quot;bytes&quot;, &quot;logicalType&quot;: &quot;decimal&quot;, &quot;precision&quot;: 10, &quot;scale&quot;: 5}
 ]
}
</code></pre>
<p>...and then use our language's Avro libraries to take care of serialization for us:</p>
<pre><code class="language-java">  FxTrade fxTrade = new FxTrade( ... );

  ProducerRecord&lt;long, FxTrade&gt; producerRecord =
    new ProducerRecord&lt;&gt;(&quot;fx_trade&quot;, fxTrade.getTradeId(), fxTrade);

  producer.send(producerRecord);
</code></pre>
<p>Alternatively, with the streaming database
<a href="https://ksqldb.io/">ksqlDB</a>, we can define an <a href="../event-stream/event-stream.html">Event
Stream</a> in a way that enforces that
format and records the Avro definition using Confluentâ€™s <a href="https://docs.confluent.io/platform/current/schema-registry/index.html">Schema
Registry</a>:</p>
<pre><code class="language-sql">CREATE OR REPLACE STREAM fx_trade (
  trade_id BIGINT KEY,
  from_currency VARCHAR(3),
  to_currency VARCHAR(3),
  price DECIMAL(10,5)
) WITH (
  KAFKA_TOPIC = 'fx_trade',
  KEY_FORMAT = 'avro',
  VALUE_FORMAT = 'avro',
  PARTITIONS = 3
);
</code></pre>
<p>With this setup, both serialization and deserialization of data is
performed automatically by ksqlDB behind the scenes.</p>
<h2 id="considerations">Considerations</h2>
<p><a href="../event-stream/event-streaming-platform.html">Event Streaming
Platforms</a> are typically
serialization-agnostic, accepting any serialized data from
human-readable text to raw bytes. However, by constraining ourselves
to more widely-accepted, structured data formats, we can open the door
to easier collaboration with other projects and programming languages.</p>
<p>Finding a "universal" serialization format isn't a new problem, or
one unique to event streaming. As such we have a number of
technology-agnostic solutions readily available. To briefly cover a
few:</p>
<ul>
<li><a href="https://www.json.org/">JSON</a>. Arguably the most successful
  serialization format in the history of computing. JSON is a
  text-based format that's easy to read, write and
  <a href="https://en.wikipedia.org/wiki/Discoverability">discover</a><sup>1</sup>,
  as evidenced by the number of languages and projects that produce
  and consume JSON data across the world with minimal collaboration.</li>
<li><a href="https://developers.google.com/protocol-buffers">Protocol
  buffers</a>. Backed by
  Google and supported by a wide variety of languages, Protobuf is a
  binary format that sacrifices the discoverability of JSON for a much
  more compact representation that uses less disk space and network
  bandwidth. Protobuf is also a strongly-typed format, allowing
  enforcement of a particular data schema from writers, and describing
  the structure of that data to readers.</li>
<li><a href="https://avro.apache.org/docs/current/">Avro</a>. A binary format similar to
  Protocol Buffers, Avro's design has focuses on supporting the
  evolution of schemas, allowing the data format to change over time
  while minimizing the impact to future readers and writer.</li>
</ul>
<p>While the choice of serialization format is important, it doesn't have
to be set in stone. It's straightforward to <a href="https://kafka-tutorials.confluent.io/changing-serialization-format/ksql.html">translate between
supported formats with
ksqlDB</a>. For
more complex scenarios, we have several strategies for managing schema
migration:</p>
<ul>
<li><a href="http://localhost:8000/event-stream/schema-evolution/">Schema
  Compatibility</a>
  discusses the kinds of "safe" schema changes that Avro is designed
  to handle transparently.</li>
<li><a href="../event-processing/event-translator.html">Event Translators</a> can
  convert between different encodings to aid consumption by different
  systems.</li>
<li><a href="http://localhost:8000/event-stream/schema-evolution/">Schema
  Evolution</a>
  discusses splitting and joining streams to simplify serving
  consumers that can only handle certain versions of the event's
  schema.</li>
<li>An <a href="event-standardizer.html">Event Standardizer</a> can reformat
  disparate data encodings into a single unified format.</li>
<li>And as a fallback we can push the problem to the consumer's code
  with a <a href="schema-on-read.html">Schema-on-Read</a> strategy.</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>The counterpart of an event serializer (for writing) is an <a href="event-deserializer.html">Event Deserializer</a> (for reading).</li>
<li>Serializers and deserializers are closely related to <a href="data-contract.html">Data
  Contracts</a>, in which we want to adhere to a
  specific serialization format <em>and</em> constrain the individual events
  to a certain schema within that format.</li>
<li>See also: <a href="../event-processing/event-mapper.html">Event Mapper</a>.</li>
</ul>
<h2 id="footnotes">Footnotes</h2>
<p><em><sup>1</sup> Older programmers will tell tales of the
less-discoverable serialization formats used by banks in the 80s, in
which deciphering the meaning of a message meant wading through a
thick, ring-bound printout of the data specification which explained the
meaning of "Field 78" by cross-referencing "Encoding Subformat 22".</em></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="event-standardizer.html" class="btn btn-neutral float-right" title="Event Standardizer">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="event-envelope.html" class="btn btn-neutral" title="Event Envelope"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="event-envelope.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="event-standardizer.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
